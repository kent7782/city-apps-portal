!function(t,e,n){function o(){m=new google.maps.places.Autocomplete(n.getElementById("city-input"),{types:["(cities)"]}),v=new google.maps.Geocoder;var o=n.getElementById("city-input");f(o),google.maps.event.addDomListener(o,"keydown",function(t){13===t.keyCode&&t.preventDefault()}),t("#background-video").css("opacity",0).animate({opacity:1},2500),m.addListener("place_changed",a),t("#purpose-label").on("click",function(){t("#purpose-list").toggleClass("dropdown-open")}),t("html, body").bind("scroll mousedown DOMMouseScroll mousewheel keyup",function(){t("html, body").stop()}),t(e).scroll(function(){t(this).scrollTop()>1.5*t(e).height()?t("#top-btn").fadeIn():t("#top-btn").fadeOut()}),t("#top-btn").click(function(){return t("html, body").animate({scrollTop:0},800),!1}),t(e).click(function(e){e.target.matches("#purpose-label")||e.target.matches("#purpose-text")||e.target.matches("#dropdown-icon")||t("#purpose-list").hasClass("dropdown-open")&&t("#purpose-list").removeClass("dropdown-open")}),t(".dropdown-item").click(function(){var e=t(this).data("genreid"),n=t(this).text();t("#purpose-label").data("genreid",e),t("#purpose-text").text(n)}),t("#locate-btn").click(function(t){t.preventDefault(),i()}),t("#search-btn").click(function(e){e.preventDefault(),t("#search-form").submit()}),t("#search-form").submit(function(t){t.preventDefault(),s()})}function a(){var t=m.getPlace();if(!t.geometry)return void(b=!1);b=!0;var e=t.formatted_address,n=t.address_components,o=r(e,n,!1);p(o)}function i(){return y?void p(y):void(navigator.geolocation?(t("#city-input").attr("placeholder","Locating..."),t("#city-input").val(""),t("#city-input").prop("disabled",!0),navigator.geolocation.getCurrentPosition(function(e){var n=e.coords.latitude,o=e.coords.longitude,a=new google.maps.LatLng(n,o);v.geocode({latLng:a},function(e,n){n==google.maps.GeocoderStatus.OK?e[1]?t.each(e,function(e,n){if(b=!0,"locality"==n.types[0]){var o=n.formatted_address,a=n.address_components,i=r(o,a,!0);return p(i),void t("#city-input").prop("disabled",!1)}}):(u("No results found."),t("#city-input").prop("disabled",!1),t("#city-input").attr("placeholder",""),b=!1):(alert("Geocoder failed due to: "+n),t("#city-input").prop("disabled",!1),t("#city-input").attr("placeholder",""),b=!1)})},function(e){t("#city-input").prop("disabled",!1),t("#city-input").attr("placeholder",""),u("Your location detection is disabled."),b=!1})):u("Your browser doen not support geolocation."))}function r(t,e,n){var o,a=e[0].long_name,i=e[e.length-1].short_name;e[3]&&(o=e[3].short_name);var r;if("US"===i||"US"===o){e[2].short_name;r=t.substring(0,t.indexOf(",")+4)}else r="GB"===i?t:a+", "+i;return n&&(y=r),w=i.toLowerCase(),w.length>2&&(w=e[e.length-2].short_name),r}function p(e){t("#city-input").animate({color:"transparent"},300,function(){t("#city-input").val(e).animate({color:"#FAFAFA"},300,function(){s()})})}function s(){return b?(t("#apps").show(),t("#apps-list").empty(),g(),t(".loader").css("display","block"),h("#apps"),void c()):void u("Please enter a valid location in the search bar")}function c(){var e,n=t("#purpose-label").data("genreid"),o=t("#city-input").val();e=o.indexOf(",")===-1?o:o.substring(0,o.indexOf(",")),e=encodeURIComponent(e);var a="https://itunes.apple.com/search?term="+e+"&genreId="+n+"&country="+w+"&lang=en_us&media=software&entity=software&sort=recent&callback=?";t.getJSON(a,function(n){if(n){results=n.results;var o=l(results,e);d(o)}t(".loader").css("display","none"),h("#apps")})}function l(e,n){for(var o=n,a=new RegExp(o,"gi"),i=t("#purpose-text").text(),r=new RegExp(i,"gi"),p=0;p<e.length;p++){var s=e[p],c=s.trackName,l=String(s.description),d=(c.match(a)||[]).length,u=(l.match(a)||[]).length,g=(c.match(r)||[]).length,h=(l.match(r)||[]).length,f=s.averageUserRating,m=s.userRatingCount,v=(e.length-p)/e.length*5,y=100,w=3.5+d+u/2,b=200,k=3.5+g+h/2,x=100;w>5&&(w=5),k>5&&(k=5),f?s.weightedRating=(f*m+v*y+w*b+k*x)/(m+y+b+x):s.weightedRating=(v*y+w*b+k*x)/(y+b+x)}return rankedList=e.slice(0),rankedList.sort(function(t,e){return e.weightedRating-t.weightedRating}),rankedList}function d(e){if(g(),!e.length)return void u("No app found. Please try another populated city area nearby.");for(var n=0;n<e.length;n++){var o=e[n];t("#apps-list").append(t("<article/>",{"class":"app-item"}).append(t("<img/>",{"class":"app-img"}).attr("src",o.artworkUrl100)).append(t("<p/>",{"class":"app-title",text:o.trackName})).append(t("<p>",{"class":"app-rating ",text:"City Apps Rating: "+o.weightedRating.toFixed(2)})).append(t("<p/>",{"class":"app-description ",text:o.description})).append(t("<p/>",{"class":"app-download "}).append(t("<a/>",{"class":"download-btn"}).attr({href:o.trackViewUrl,target:"_blank",role:"button"}).html("Download &raquo;"))).append(t("<br>")).append(t("<hr>")).append(t("<br>")))}}function u(e){t("#apps").show(),t("#apps-list").empty(),t("#message").show().text(e),h("#message")}function g(){t("#message").hide()}function h(e){"bottom"===e||(t("html, body").stop(),t("html, body").animate({scrollTop:t(e).offset().top},800))}function f(e){function n(n,a){if("keydown"==n){var i=a;a=function(n){var o=t(".pac-item-selected").length>0;if(13==n.which&&!o){var a=t.Event("keydown",{keyCode:40,which:40});i.apply(e,[a])}i.apply(e,[n])}}o.apply(e,[n,a])}var o=e.addEventListener?e.addEventListener:e.attachEvent;e.addEventListener?e.addEventListener=n:e.attachEvent&&(e.attachEvent=n)}var m,v,y,w,b=!1;revealingModule={initAutocomplete:o}}(window.jQuery,window,document);