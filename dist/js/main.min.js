!function(e,t,n){function a(){m=new google.maps.places.Autocomplete(n.getElementById("city-input"),{types:["(cities)"]}),v=new google.maps.Geocoder;var t=n.getElementById("city-input");f(t),google.maps.event.addDomListener(t,"keydown",function(e){13===e.keyCode&&e.preventDefault()}),L.css("opacity",0).animate({opacity:1},2500),m.addListener("place_changed",o),E.on("click",function(){R.toggleClass("dropdown-open")}),x.bind("scroll mousedown DOMMouseScroll mousewheel keyup",function(){x.stop()}),k.scroll(function(){e(this).scrollTop()>1.5*k.height()?D.fadeIn():D.fadeOut()}),D.click(function(){return x.animate({scrollTop:0},800),!1}),k.click(function(e){e.target.matches("#purpose-label")||e.target.matches("#purpose-text")||e.target.matches("#dropdown-icon")||R.hasClass("dropdown-open")&&R.removeClass("dropdown-open")}),C.click(function(){var t=e(this).data("genreid"),n=e(this).text();E.data("genreid",t),_.text(n)}),O.click(function(e){e.preventDefault(),r()}),A.click(function(e){e.preventDefault(),S.submit()}),S.submit(function(e){e.preventDefault(),c()})}function o(){var e=m.getPlace();if(!e.geometry)return void(b=!1);b=!0;var t=e.formatted_address,n=e.address_components,a=i(t,n,!1);s(a)}function r(){return w?void s(w):void(navigator.geolocation?(U.attr("placeholder","Locating..."),U.val(""),U.prop("disabled",!0),navigator.geolocation.getCurrentPosition(function(t){var n=t.coords.latitude,a=t.coords.longitude,o=new google.maps.LatLng(n,a);v.geocode({latLng:o},function(t,n){n==google.maps.GeocoderStatus.OK?t[1]?e.each(t,function(e,t){if(b=!0,"locality"==t.types[0]){var n=t.formatted_address,a=t.address_components,o=i(n,a,!0);return s(o),void U.prop("disabled",!1)}}):(u("No results found."),U.prop("disabled",!1),U.attr("placeholder",""),b=!1):(alert("Geocoder failed due to: "+n),U.prop("disabled",!1),U.attr("placeholder",""),b=!1)})},function(e){U.prop("disabled",!1),U.attr("placeholder",""),u("Your location detection is disabled."),b=!1})):u("Your browser doen not support geolocation."))}function i(e,t,n){var a,o=t[0].long_name,r=t[t.length-1].short_name;t[3]&&(a=t[3].short_name);var i;if("US"===r||"US"===a){t[2].short_name;i=e.substring(0,e.indexOf(",")+4)}else i="GB"===r?e:o+", "+r;return n&&(w=i),y=r.toLowerCase(),y.length>2&&(y=t[t.length-2].short_name),i}function s(e){U.animate({color:"transparent"},300,function(){U.val(e).animate({color:"#FAFAFA"},300,function(){c()})})}function c(){return b?(I.show(),N.empty(),g(),F.css("display","block"),h("#apps-container"),void p()):void u("Please enter a valid location in the search bar")}function p(){var t,n=E.data("genreid"),a=U.val();t=a.indexOf(",")===-1?a:a.substring(0,a.indexOf(",")),t=encodeURIComponent(t);var o="https://itunes.apple.com/search?term="+t+"&genreId="+n+"&country="+y+"&lang=en_us&media=software&entity=software&sort=recent&callback=?";e.getJSON(o,function(e){if(e){results=e.results;var n=d(results,t);l(n)}F.css("display","none"),h("#apps-container")})}function d(e,t){for(var n=t,a=new RegExp(n,"gi"),o=_.text(),r=new RegExp(o,"gi"),i=0;i<e.length;i++){var s=e[i],c=s.trackName,p=String(s.description),d=(c.match(a)||[]).length,l=(p.match(a)||[]).length,u=(c.match(r)||[]).length,g=(p.match(r)||[]).length,h=s.averageUserRating,f=s.userRatingCount,m=(e.length-i)/e.length*5,v=100,w=3.5+d+l/2,y=200,b=3.5+u+g/2,k=100;w>5&&(w=5),b>5&&(b=5),h?s.weightedRating=(h*f+m*v+w*y+b*k)/(f+v+y+k):s.weightedRating=(m*v+w*y+b*k)/(v+y+k)}return rankedList=e.slice(0),rankedList.sort(function(e,t){return t.weightedRating-e.weightedRating}),rankedList}function l(t){if(g(),!t.length)return void u("No app found. Please try another populated city area nearby.");for(var n=0;n<t.length;n++){var a=t[n];N.append(e("<article/>",{"class":"app-item"}).append(e("<img/>",{"class":"app-img"}).attr("src",a.artworkUrl100)).append(e("<p/>",{"class":"app-title",text:a.trackName})).append(e("<p>",{"class":"app-rating ",text:"City Apps Rating: "+a.weightedRating.toFixed(2)})).append(e("<p/>",{"class":"app-description ",text:a.description})).append(e("<p/>",{"class":"app-download "}).append(e("<a/>",{"class":"download-btn"}).attr({href:a.trackViewUrl,target:"_blank",role:"button"}).html("Download &raquo;"))).append(e("<br>")).append(e("<hr>")).append(e("<br>")))}}function u(e){I.show(),N.empty(),G.show().text(e),h("#message")}function g(){G.hide()}function h(t){"bottom"===t||(x.stop(),x.animate({scrollTop:e(t).offset().top},800))}function f(t){function n(n,o){if("keydown"==n){var r=o;o=function(n){var a=e(".pac-item-selected").length>0;if(13==n.which&&!a){var o=e.Event("keydown",{keyCode:40,which:40});r.apply(t,[o])}r.apply(t,[n])}}a.apply(t,[n,o])}var a=t.addEventListener?t.addEventListener:t.attachEvent;t.addEventListener?t.addEventListener=n:t.attachEvent&&(t.attachEvent=n)}var m,v,w,y,b=!1,k=e(t),x=e("html, body"),L=e("#background-video"),E=e("#purpose-label"),_=e("#purpose-text"),R=e("#purpose-list"),C=e(".dropdown-item"),D=e("#top-btn"),O=e("#locate-btn"),A=e("#search-btn"),S=e("#search-form"),U=e("#city-input"),I=e("#apps-container"),N=e("#apps-list"),F=e("#search-loader"),G=e("#message");revealingModule={initAutocomplete:a}}(window.jQuery,window,document);